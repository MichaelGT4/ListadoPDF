var rp=rp||{};rp.chat.LayerChatModuleV2=function(){!function(e){var t;if("function"==typeof define&&define.amd&&(define(e),t=!0),"object"==typeof exports&&(module.exports=e(),t=!0),!t){var o=window.Cookies,n=window.Cookies=e();n.noConflict=function(){return window.Cookies=o,n}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var o=arguments[e];for(var n in o)t[n]=o[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function o(n){function i(){}function s(t,o,s){if("undefined"!=typeof document){"number"==typeof(s=e({path:"/"},i.defaults,s)).expires&&(s.expires=new Date(1*new Date+864e5*s.expires)),s.expires=s.expires?s.expires.toUTCString():"";try{var a=JSON.stringify(o);/^[\{\[]/.test(a)&&(o=a)}catch(e){}o=n.write?n.write(o,t):encodeURIComponent(o+"").replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(t+"").replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var r="";for(var c in s)s[c]&&(r+="; "+c,!0!==s[c]&&(r+="="+s[c].split(";")[0]));return document.cookie=t+"="+o+r}}function a(e,o){if("undefined"!=typeof document){for(var i={},s=document.cookie?document.cookie.split("; "):[],a=0;a<s.length;a++){var r=s[a].split("="),c=r.slice(1).join("=");o||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var d=t(r[0]);if(c=(n.read||n)(c,d)||t(c),o)try{c=JSON.parse(c)}catch(e){}if(i[d]=c,e===d)break}catch(e){}}return e?i[e]:i}}return i.set=s,i.get=function(e){return a(e,!1)},i.getJSON=function(e){return a(e,!0)},i.remove=function(t,o){s(t,"",e(o,{expires:-1}))},i.defaults={},i.withConverter=o,i}(function(){})});var e,t,o,n,i=(e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,o=/[^-+\dA-Z]/g,n=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e},function(s,a,r){var c=i;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(s)||/\d/.test(s)||(a=s,s=void 0),s=s?new Date(s):new Date,isNaN(s))throw SyntaxError("invalid date");"UTC:"==(a=String(c.masks[a]||a||c.masks.default)).slice(0,4)&&(a=a.slice(4),r=!0);var d=r?"getUTC":"get",l=s[d+"Date"](),p=s[d+"Day"](),u=s[d+"Month"](),h=s[d+"FullYear"](),m=s[d+"Hours"](),f=s[d+"Minutes"](),g=s[d+"Seconds"](),v=s[d+"Milliseconds"](),y=r?0:s.getTimezoneOffset(),_={d:l,dd:n(l),ddd:c.i18n.dayNames[p],dddd:c.i18n.dayNames[p+7],m:u+1,mm:n(u+1),mmm:c.i18n.monthNames[u],mmmm:c.i18n.monthNames[u+12],yy:String(h).slice(2),yyyy:h,h:m%12||12,hh:n(m%12||12),H:m,HH:n(m),M:f,MM:n(f),s:g,ss:n(g),l:n(v,3),L:n(v>99?Math.round(v/10):v),t:m<12?"a":"p",tt:m<12?"am":"pm",T:m<12?"A":"P",TT:m<12?"AM":"PM",Z:r?"UTC":(String(s).match(t)||[""]).pop().replace(o,""),o:(y>0?"-":"+")+n(100*Math.floor(Math.abs(y)/60)+Math.abs(y)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return a.replace(e,function(e){return e in _?_[e]:e.slice(1,e.length-1)})});i.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},i.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return i(this,e,t)},function(e,t){"function"==typeof define&&define.amd?define(function(){return t(e)}):"object"==typeof module&&module.exports?module.exports=t(e):e.ss=t(e)}("undefined"!=typeof window?window:this,function(e){var t,o=e.ss||{},n=/^\s+/,i=/\s+$/,s=/[xy]/g,a=/.*(\/|\\)/,r=/.*[.]/,c=/[\t\r\n]/g,d=Object.prototype.toString.call(e.HTMLElement).indexOf("Constructor")>0,l=-1!==navigator.userAgent.indexOf("MSIE 7"),p=document.createElement("input");p.type="file",t="multiple"in p&&"undefined"!=typeof File&&void 0!==(new XMLHttpRequest).upload,o.obj2string=function(e,t){"use strict";var n=[];for(var i in e)if(e.hasOwnProperty(i)){var s=t?t+"["+i+"]":i,a=e[i];n.push("object"==typeof a?o.obj2string(a,s):encodeURIComponent(s)+"="+encodeURIComponent(a))}return n.join("&")},o.extendObj=function(e,t){"use strict";for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])},o.addEvent=function(e,t,n){"use strict";return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n),function(){o.removeEvent(e,t,n)}},o.removeEvent=document.removeEventListener?function(e,t,o){e.removeEventListener&&e.removeEventListener(t,o,!1)}:function(e,t,o){var n="on"+t;void 0===e[n]&&(e[n]=null),e.detachEvent(n,o)},o.newXHR=function(){"use strict";if("undefined"!=typeof XMLHttpRequest)return new e.XMLHttpRequest;if(e.ActiveXObject)try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}},o.encodeUTF8=function(e){"use strict";return unescape(encodeURIComponent(e))},o.getIFrame=function(){"use strict";var e,t=o.getUID();return l?e=document.createElement('<iframe src="javascript:false;" name="'+t+'">'):((e=document.createElement("iframe")).src="javascript:false;",e.name=t),e.style.display="none",e.id=t,e},o.getForm=function(e){"use strict";var t=document.createElement("form");for(var o in t.encoding="multipart/form-data",t.enctype="multipart/form-data",t.style.display="none",e)e.hasOwnProperty(o)&&(t[o]=e[o]);return t},o.getHidden=function(e,t){"use strict";var o=document.createElement("input");return o.type="hidden",o.name=e,o.value=t,o},o.parseJSON=function(t){"use strict";if(!t)return!1;if(t=o.trim(t+""),e.JSON&&e.JSON.parse)try{return e.JSON.parse(t+"")}catch(e){return!1}var n,i=null;return!(!t||o.trim(t.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,function(e,t,o,s){return n&&t&&(i=0),0===i?e:(n=o||t,i+=!s-!o,"")})))&&Function("return "+t)()},o.getBox=function(t){"use strict";var o,n,i=0,s=0;if(t.getBoundingClientRect)o=t.getBoundingClientRect(),n=document.documentElement,i=o.top+(e.pageYOffset||n.scrollTop)-(n.clientTop||0),s=o.left+(e.pageXOffset||n.scrollLeft)-(n.clientLeft||0);else do{s+=t.offsetLeft,i+=t.offsetTop}while(t=t.offsetParent);return{top:Math.round(i),left:Math.round(s)}},o.addStyles=function(e,t){"use strict";for(var o in t)t.hasOwnProperty(o)&&(e.style[o]=t[o])},o.copyLayout=function(e,t){"use strict";var n=o.getBox(e);o.addStyles(t,{position:"absolute",left:n.left+"px",top:n.top+"px",width:e.offsetWidth+"px",height:e.offsetHeight+"px"})},o.getUID=function(){"use strict";return"axxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(s,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})};var u="".trim;return o.trim=u&&!u.call("\ufeffï¿½")?function(e){return null===e?"":u.call(e)}:function(e){return e.toString().replace(n,"").replace(i,"")},o.getFilename=function(e){"use strict";return e.replace(a,"")},o.getExt=function(e){"use strict";return-1!==e.indexOf(".")?e.replace(r,""):""},o.hasClass=function(e,t){"use strict";return!(!e||!t)&&(" "+e.className+" ").replace(c," ").indexOf(" "+t+" ")>=0},o.addClass=function(e,t){"use strict";return!(!e||!t)&&void(o.hasClass(e,t)||(e.className+=" "+t))},o.removeClass=function(){"use strict";var e={};return function(t,o){return!(!t||!o)&&(e[o]||(e[o]=new RegExp("(?:^|\\s)"+o+"(?!\\S)")),void(t.className=t.className.replace(e[o],"")))}}(),o.purge=function(e){"use strict";var t,n,i,s=e.attributes;if(s)for(t=s.length-1;t>=0;t-=1)"function"==typeof e[i=s[t].name]&&(e[i]=null);if(s=e.childNodes)for(n=s.length,t=0;n>t;t+=1)o.purge(e.childNodes[t])},o.remove=function(e){"use strict";e&&e.parentNode&&(o.purge(e),e.parentNode.removeChild(e)),e=null},o.verifyElem=function(t){"use strict";return void 0!==R&&t instanceof R?t=t[0]:"string"==typeof t&&("#"==t.charAt(0)&&(t=t.substr(1)),t=document.getElementById(t)),!(!t||1!==t.nodeType)&&("A"==t.nodeName.toUpperCase()&&(t.style.cursor="pointer",o.addEvent(t,"click",function(t){t&&t.preventDefault?t.preventDefault():e.event&&(e.event.returnValue=!1)})),t)},o._options={},o.uploadSetup=function(e){"use strict";o.extendObj(o._options,e)},o.SimpleUpload=function(e){"use strict";var n,i,s;if(this._opts={button:"",url:"",dropzone:"",dragClass:"",cors:!1,withCredentials:!1,progressUrl:!1,sessionProgressUrl:!1,nginxProgressUrl:!1,multiple:!1,maxUploads:3,queue:!0,checkProgressInterval:500,keyParamName:"APC_UPLOAD_PROGRESS",sessionProgressName:"PHP_SESSION_UPLOAD_PROGRESS",nginxProgressHeader:"X-Progress-ID",corsInputName:"XHR_CORS_TARGETORIGIN",allowedExtensions:[],accept:"",maxSize:!1,name:"",data:{},noParams:!1,autoSubmit:!0,multipart:!1,method:"POST",responseType:"",debug:!1,hoverClass:"",focusClass:"",disabledClass:"",customHeaders:{},encodeHeaders:!0,onAbort:function(e,t,o){},onChange:function(e,t,o,n,i){},onSubmit:function(e,t,o,n){},onProgress:function(e){},onUpdateFileSize:function(e){},onComplete:function(e,t,o,n){},onExtError:function(e,t){},onSizeError:function(e,t){},onError:function(e,t,o,n,i,s,a){},startXHR:function(e,t,o){},endXHR:function(e,t,o){},startNonXHR:function(e,t){},endNonXHR:function(e,t){}},o.extendObj(this._opts,o._options),o.extendObj(this._opts,e),e=null,this._btns=[],this._opts.button instanceof Array)for(i=this._opts.button.length,n=0;i>n;n++)!1!==(s=o.verifyElem(this._opts.button[n]))?this._btns.push(this.rerouteClicks(s)):this.log("Button with array index "+n+" is invalid");else!1!==(s=o.verifyElem(this._opts.button))&&this._btns.push(this.rerouteClicks(s));if(delete this._opts.button,this._opts.button=s=null,""===this._opts.dropzone&&(this._btns.length<1||!1===this._btns[0]))throw new Error("Invalid button. Make sure the element you're passing exists.");!1===this._opts.multiple&&(this._opts.maxUploads=1),this._queue=[],this._active=0,this._disabled=!1,this._maxFails=10,this._progKeys={},t||(this._sizeFlags={}),t&&""!==this._opts.dropzone&&(this._dzone=o.verifyElem(this._opts.dropzone),this._dzone?this.addDropZone(this._dzone):this.log("Invalid or nonexistent element passed for drop zone")),this._createInput(),this._manDisabled=!1,this.enable(!0)},o.SimpleUpload.prototype={_killInput:function(){"use strict";this._input&&(this._input.turnOff&&this._input.turnOff(),this._input.focusOff&&this._input.focusOff(),this._input.blurOff&&this._input.blurOff(),this._input.parentNode.mouseOverOff&&this._input.parentNode.mouseOverOff(),o.remove(this._input.parentNode),delete this._input,this._input=null)},destroy:function(){"use strict";for(var e=this._btns.length;e--;)this._btns[e].off&&this._btns[e].off(),o.removeClass(this._btns[e],this._opts.hoverClass),o.removeClass(this._btns[e],this._opts.focusClass),o.removeClass(this._btns[e],this._opts.disabledClass),this._btns[e].disabled=!1;this._killInput(),this._destroy=!0},log:function(t){"use strict";this._opts&&this._opts.debug&&e.console&&e.console.log&&e.console.log("[Uploader] "+t)},setData:function(e){"use strict";this._opts.data=e},setOptions:function(e){"use strict";o.extendObj(this._opts,e)},setProgressBar:function(e){"use strict";this._progBar=o.verifyElem(e)},setPctBox:function(e){"use strict";this._pctBox=o.verifyElem(e)},setFileSizeBox:function(e){"use strict";this._sizeBox=o.verifyElem(e)},setProgressContainer:function(e){"use strict";this._progBox=o.verifyElem(e)},setAbortBtn:function(e,t){"use strict";this._abortBtn=o.verifyElem(e),this._removeAbort=!1,t&&(this._removeAbort=!0)},getQueueSize:function(){"use strict";return this._queue.length},_cycleQueue:function(){"use strict";this._queue.length>0&&this._opts.autoSubmit&&this.submit()},removeCurrent:function(e){"use strict";if(e){for(var t=this._queue.length;t--;)if(this._queue[t].id===e){this._queue.splice(t,1);break}}else this._queue.splice(0,1);this._cycleQueue()},clearQueue:function(){"use strict";this._queue.length=0},disable:function(e){"use strict";var t,n=this._btns.length;for(this._manDisabled=!e||!0===this._manDisabled,this._disabled=!0;n--;)("INPUT"==(t=this._btns[n].nodeName.toUpperCase())||"BUTTON"==t)&&(this._btns[n].disabled=!0),""!==this._opts.disabledClass&&o.addClass(this._btns[n],this._opts.disabledClass);this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(e){"use strict";if(e||(this._manDisabled=!1),!0!==this._manDisabled){var t=this._btns.length;for(this._disabled=!1;t--;)o.removeClass(this._btns[t],this._opts.disabledClass),this._btns[t].disabled=!1}},updatePosition:function(e){"use strict";(e=e||this._btns[0])&&this._input&&this._input.parentNode&&o.copyLayout(e,this._input.parentNode),e=null}},o.IframeUpload={_getHost:function(e){var t=document.createElement("a");return t.href=e,t.hostname?t.hostname.toLowerCase():e},_addFiles:function(e){var t=o.getFilename(e.value),n=o.getExt(t);return!1!==this._opts.onChange.call(this,t,n,this._overBtn,void 0,e)&&(this._queue.push({id:o.getUID(),file:e,name:t,ext:n,btn:this._overBtn,size:null}),!0)},_uploadIframe:function(t,n,i,s,a,r,c){"use strict";var d,l,p,u,h,m=this,f=this._opts,g=o.getUID(),v=o.getIFrame(),y=!1,_=!1;l=!0===f.noParams?f.url:f.nginxProgressUrl?l+(l.indexOf("?")>-1?"&":"?")+encodeURIComponent(f.nginxProgressHeader)+"="+encodeURIComponent(g):f.url,d=o.getForm({action:l,target:v.name,method:f.method}),f.onProgress.call(this,0),a&&(a.innerHTML="0%"),s&&(s.style.width="0%"),f.cors&&(p=o.addEvent(e,"message",function(e){return m._getHost(e.origin)!=m._getHost(f.url)?void m.log("Non-matching origin: "+e.origin):(y=!0,p(),f.endNonXHR.call(m,t.name,t.btn),void m._finish(t,"","",e.data,i,n,a,r,c))}));var C=o.addEvent(v,"load",function(){for(var l in C(),f.sessionProgressUrl?d.appendChild(o.getHidden(f.sessionProgressName,g)):f.progressUrl&&d.appendChild(o.getHidden(f.keyParamName,g)),f.data)f.data.hasOwnProperty(l)&&d.appendChild(o.getHidden(l,f.data[l]));f.cors&&d.appendChild(o.getHidden(f.corsInputName,e.location.href)),d.appendChild(t.file),u=o.addEvent(v,"load",function(){if(v.parentNode&&!_)if(_=!0,delete m._progKeys[g],delete m._sizeFlags[g],u(),r&&o.removeEvent(r,"click",h),f.cors)e.setTimeout(function(){o.remove(d),o.remove(v),y||m._errorFinish(t,"","",!1,"error",n,i,a,r,c),f=g=d=v=i=n=a=r=c=null},600);else{try{var s=(v.contentDocument?v.contentDocument:v.contentWindow.document).body.innerHTML;f.endNonXHR.call(m,t.name,t.btn),m._finish(t,"","",s,i,n,a,r,c)}catch(e){m._errorFinish(t,"",e.message,!1,"error",n,i,a,r,c)}e.setTimeout(function(){o.remove(d),o.remove(v),d=v=null},0),t=f=g=i=n=a=null}}),r&&(h=function(){if(o.removeEvent(r,"click",h),delete m._progKeys[g],delete m._sizeFlags[g],v){_=!0,u();try{v.contentWindow.document.execCommand&&v.contentWindow.document.execCommand("Stop")}catch(e){}try{v.src="javascript".concat(":false;")}catch(e){}e.setTimeout(function(){o.remove(d),o.remove(v),d=v=null},0)}m.log("Upload aborted"),f.onAbort.call(m,t.name,t.btn,t.size),m._last(i,n,a,r,c)},o.addEvent(r,"click",h)),m.log("Commencing upload using iframe"),d.submit(),m._hasProgUrl&&(m._progKeys[g]=1,e.setTimeout(function(){m._getProg(g,s,i,a,1),s=i=a=null},600)),e.setTimeout(function(){m.removeCurrent(t.id)},0)});document.body.appendChild(d),document.body.appendChild(v)},_getProg:function(t,n,i,s,a){"use strict";var r,c,d,l=this,p=this._opts,u=(new Date).getTime();if(t)if(p.nginxProgressUrl?c=p.nginxProgressUrl+"?"+encodeURIComponent(p.nginxProgressHeader)+"="+encodeURIComponent(t)+"&_="+u:p.sessionProgressUrl?c=p.sessionProgressUrl:p.progressUrl&&(c=p.progressUrl+"?progresskey="+encodeURIComponent(t)+"&_="+u),d=function(){var c,u,h,m,f;try{if(d&&(p.cors||4===r.readyState)){d=void 0,r.onreadystatechange=function(){};try{f=r.statusText,m=r.status}catch(e){f="",m=""}if(p.cors||m>=200&&300>m){if(!1===(c=o.parseJSON(r.responseText)))return void l.log("Error parsing progress response (expecting JSON)");if(p.nginxProgressUrl){if("uploading"==c.state)(u=parseInt(c.size,10))>0&&(h=Math.round(parseInt(c.received,10)/u*100),u=Math.round(u/1024));else if("done"==c.state)h=100;else if("error"==c.state)return void l.log("Error requesting upload progress: "+c.status)}else(p.sessionProgressUrl||p.progressUrl)&&!0===c.success&&(u=parseInt(c.size,10),h=parseInt(c.pct,10));if(h&&(s&&(s.innerHTML=h+"%"),n&&(n.style.width=h+"%"),p.onProgress.call(l,h)),u&&!l._sizeFlags[t]&&(i&&(i.innerHTML=u+"K"),l._sizeFlags[t]=1,p.onUpdateFileSize.call(l,u)),!h&&!u&&a>=l._maxFails)return a++,void l.log("Failed progress request limit reached. Count: "+a);100>h&&l._progKeys[t]&&e.setTimeout(function(){l._getProg(t,n,i,s,a),t=n=i=s=a=null},p.checkProgressInterval)}else delete l._progKeys[t],l.log("Error requesting upload progress: "+m+" "+f);r=u=h=m=f=c=null}}catch(e){l.log("Error requesting upload progress: "+e.message)}},p.cors&&!p.sessionProgressUrl){if(!e.XDomainRequest)return;(r=new e.XDomainRequest).open("GET",c,!0),r.onprogress=r.ontimeout=function(){},r.onload=d,r.onerror=function(){delete l._progKeys[t],t=null,l.log("Error requesting upload progress")}}else{var h,m=p.sessionProgressUrl?"POST":"GET";(r=o.newXHR()).onreadystatechange=d,r.open(m,c,!0),p.sessionProgressUrl&&(h=encodeURIComponent(p.sessionProgressName)+"="+encodeURIComponent(t),r.setRequestHeader("Content-type","application/x-www-form-urlencoded")),p.nginxProgressUrl&&r.setRequestHeader(p.nginxProgressHeader,t),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01"),r.send(p.sessionProgressUrl&&h||null)}},_initUpload:function(e){return!1===this._opts.startNonXHR.call(this,e.name,e.btn)?(this._disabled&&this.enable(!0),void this._active--):(this._hasProgUrl=!!(this._opts.progressUrl||this._opts.sessionProgressUrl||this._opts.nginxProgressUrl),this._uploadIframe(e,this._progBox,this._sizeBox,this._progBar,this._pctBox,this._abortBtn,this._removeAbort),void(this._progBox=this._sizeBox=this._progBar=this._pctBox=this._abortBtn=this._removeAbort=null))}},o.XhrUpload={_addFiles:function(e){var t,n,i,s,a=e.length;for(this._opts.multiple||(a=1),s=0;a>s;s++){if(t=o.getFilename(e[s].name),n=o.getExt(t),i=Math.round(e[s].size/1024),!1===this._opts.onChange.call(this,t,n,this._overBtn,i,e[s]))return!1;this._queue.push({id:o.getUID(),file:e[s],name:t,ext:n,btn:this._overBtn,size:i})}return!0},_uploadXhr:function(e,t,n,i,s,a,r,c,d,l){"use strict";var p,u,h=this,m=this._opts,f=o.newXHR();for(var g in s&&(s.innerHTML=e.size+"K"),c&&(c.innerHTML="0%"),a&&(a.style.width="0%"),p=function(t,n){var i;try{if(p&&(n||4===f.readyState))if(p=void 0,f.onreadystatechange=function(){},n)4!==f.readyState&&f.abort(),m.onAbort.call(h,e.name,e.btn,e.size),h._last(s,r,c,d,l);else{d&&o.removeEvent(d,"click",u);try{i=f.statusText}catch(e){i=""}f.status>=200&&f.status<300?(m.endXHR.call(h,e.name,e.size,e.btn),h._finish(e,f.status,i,f.responseText,s,r,c,d,l)):h._errorFinish(e,f.status,i,f.responseText,"error",r,s,c,d,l)}}catch(t){n||h._errorFinish(e,-1,t.message,!1,"error",r,s,c,d,l)}},d&&(u=function(){o.removeEvent(d,"click",u),p&&p(void 0,!0)},o.addEvent(d,"click",u)),f.onreadystatechange=p,f.open(m.method.toUpperCase(),t,!0),f.withCredentials=!!m.withCredentials,o.extendObj(i,m.customHeaders),i)i.hasOwnProperty(g)&&(m.encodeHeaders?f.setRequestHeader(g,o.encodeUTF8(i[g]+"")):f.setRequestHeader(g,i[g]+""));if(o.addEvent(f.upload,"progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);m.onProgress.call(h,t),c&&(c.innerHTML=t+"%"),a&&(a.style.width=t+"%")}}),m.onProgress.call(this,0),!0===m.multipart){var v=new FormData;for(var y in n)n.hasOwnProperty(y)&&v.append(y,n[y]);v.append(m.name,e.file),this.log("Commencing upload using multipart form"),f.send(v)}else this.log("Commencing upload using binary stream"),f.send(e.file);this.removeCurrent(e.id)},_initUpload:function(e){"use strict";var t,n={},i={};return!1===this._opts.startXHR.call(this,e.name,e.size,e.btn)?(this._disabled&&this.enable(!0),void this._active--):(n[this._opts.name]=e.name,i["X-Requested-With"]="XMLHttpRequest",i["X-File-Name"]=e.name,"json"==this._opts.responseType.toLowerCase()&&(i.Accept="application/json, text/javascript, */*; q=0.01"),this._opts.multipart||(i["Content-Type"]="application/octet-stream"),o.extendObj(n,this._opts.data),t=!0===this._opts.noParams?this._opts.url:this._opts.url+(this._opts.url.indexOf("?")>-1?"&":"?")+o.obj2string(n),this._uploadXhr(e,t,n,i,this._sizeBox,this._progBar,this._progBox,this._pctBox,this._abortBtn,this._removeAbort),void(this._sizeBox=this._progBar=this._progBox=this._pctBox=this._abortBtn=this._removeAbort=null))}},o.extendObj(o.SimpleUpload.prototype,{_createInput:function(){"use strict";var e=this,n=document.createElement("div");this._input=document.createElement("input"),this._input.type="file",this._input.name=this._opts.name,t&&!d&&this._opts.multiple&&(this._input.multiple=!0),"accept"in this._input&&""!==this._opts.accept&&(this._input.accept=this._opts.accept),o.addStyles(n,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:16777270}),o.addStyles(this._input,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer",height:"100%"}),"0"!==n.style.opacity&&(n.style.filter="alpha(opacity=0)"),this._input.turnOff=o.addEvent(this._input,"change",function(){e._input&&""!==e._input.value&&!1!==e._addFiles(t?e._input.files:e._input)&&(o.removeClass(e._overBtn,e._opts.hoverClass),o.removeClass(e._overBtn,e._opts.focusClass),e._killInput(),e._createInput(),e._opts.autoSubmit&&e.submit())}),""!==e._opts.hoverClass&&(n.mouseOverOff=o.addEvent(n,"mouseover",function(){o.addClass(e._overBtn,e._opts.hoverClass)})),n.mouseOutOff=o.addEvent(n,"mouseout",function(){e._input.parentNode.style.visibility="hidden",""!==e._opts.hoverClass&&(o.removeClass(e._overBtn,e._opts.hoverClass),o.removeClass(e._overBtn,e._opts.focusClass))}),""!==e._opts.focusClass&&(this._input.focusOff=o.addEvent(this._input,"focus",function(){o.addClass(e._overBtn,e._opts.focusClass)}),this._input.blurOff=o.addEvent(this._input,"blur",function(){o.removeClass(e._overBtn,e._opts.focusClass)})),document.body.appendChild(n),n.appendChild(this._input),n=null},rerouteClicks:function(e){"use strict";var t=this;return e.off=o.addEvent(e,"mouseover",function(){t._disabled||(t._input||t._createInput(),t._overBtn=e,o.copyLayout(e,t._input.parentNode),t._input.parentNode.style.visibility="visible")}),e},_last:function(e,t,n,i,s){"use strict";if(e&&(e.innerHTML=""),n&&(n.innerHTML=""),i&&s&&o.remove(i),t&&o.remove(t),this._active--,e=t=n=i=s=null,this._disabled&&this.enable(!0),this._destroy&&0===this._queue.length&&0===this._active.length)for(var a in this)this.hasOwnProperty(a)&&delete this[a];else this._cycleQueue()},_errorFinish:function(e,t,o,n,i,s,a,r,c,d){"use strict";this.log("Upload failed: "+t+" "+o),this._opts.onError.call(this,e.name,i,t,o,n,e.btn,e.size),this._last(a,s,r,c,d),e=t=o=n=i=a=s=r=c=d=null},_finish:function(e,t,n,i,s,a,r,c,d){"use strict";return this.log("Server response: "+i),"json"==this._opts.responseType.toLowerCase()&&!1===(i=o.parseJSON(i))?void this._errorFinish(e,t,n,!1,"parseerror",a,s,c,d):(this._opts.onComplete.call(this,e.name,i,e.btn,e.size),this._last(s,a,r,c,d),void(e=t=n=i=s=a=r=c=d=null))},_checkFile:function(e){"use strict";var t=!1,o=this._opts.allowedExtensions.length;if(o>0){for(;o--;)if(this._opts.allowedExtensions[o].toLowerCase()==e.ext.toLowerCase()){t=!0;break}if(!t)return this.removeCurrent(e.id),this.log("File extension not permitted"),this._opts.onExtError.call(this,e.name,e.ext),!1}return e.size&&!1!==this._opts.maxSize&&e.size>this._opts.maxSize?(this.removeCurrent(e.id),this.log(e.name+" exceeds "+this._opts.maxSize+"K limit"),this._opts.onSizeError.call(this,e.name,e.size),!1):(e=null,!0)},submit:function(){"use strict";this._disabled||this._active>=this._opts.maxUploads||this._queue.length<1||this._checkFile(this._queue[0])&&!1!==this._opts.onSubmit.call(this,this._queue[0].name,this._queue[0].ext,this._queue[0].btn,this._queue[0].size)&&(this._active++,(!1===this._opts.multiple||!1===this._opts.queue&&this._active>=this._opts.maxUploads)&&this.disable(!0),this._initUpload(this._queue[0]))}}),t?o.extendObj(o.SimpleUpload.prototype,o.XhrUpload):o.extendObj(o.SimpleUpload.prototype,o.IframeUpload),o.extendObj(o.SimpleUpload.prototype,{_dragFileCheck:function(e){if(e.dataTransfer.types)for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"==e.dataTransfer.types[t])return!0;return!1},addDropZone:function(e){var t=this;o.addStyles(e,{zIndex:16777271}),e.ondragenter=function(e){return e.stopPropagation(),e.preventDefault(),!!t._dragFileCheck(e)&&(o.addClass(this,t._opts.dragClass),!1)},e.ondragover=function(e){return e.stopPropagation(),e.preventDefault(),!1},e.ondragend=function(){return o.removeClass(this,t._opts.dragClass),!1},e.ondragleave=function(){return o.removeClass(this,t._opts.dragClass),!1},e.ondrop=function(e){e.stopPropagation(),e.preventDefault(),o.removeClass(this,t._opts.dragClass),t._dragFileCheck(e)&&!1!==t._addFiles(e.dataTransfer.files)&&t._cycleQueue()}}}),o});var s,a,r,c,d,l,p,u,h,m,f,g,v,y,_,C,b,w,k,x,T,S=rp.chat.Core.getBrowserHeight(),M=rp.chat.Core.getBrowserWidth(),E=0,R=rp.chat.Core.getJQ(),I=(R("#rp-chat-minimize-button"),R("#rp-chat-minimize-button"),R("#rp-chat-minimize-button")),L=rp.chat.Core.getDeptId(),P=R("head"),D=R("body"),O=escape(rp.chat.Core.getSessionRp()),U=rp.chat.Core.getConfig(),N=rp.chat.Core.getRPDomain("dialog"),B=rp.chat.Core.getRPDomain(),q=(rp.chat.Core.getFirstDomainName(),{window:"prechat",left:0,top:0,minimized:!1,closed:!0,"chat-id":0,"dept-id":0,unread:0,botQuickReplies:[],saveTranscript:1}),F=(rp.chat.Core.getWebRTCDetected(),N+"/../socket/socket.io/socket.io.js"),H=!1,A=!1,z=!1,j=this;this.loadDepencies=function(e){switch(e){case"postchat":rp.chat.loadScript(N+"/third-party/jquery-bar-rating/jquery.barrating.min.js",function(){s.find(".stars").barrating({theme:"rp-stars-o"})})}},this.bindScrollEvents=function(){R("#chat-conversation").on("scroll",function(e){var t=e.target.scrollHeight-e.target.clientHeight-e.target.scrollTop;j.showScrollDownButton(t>32)}),R(document).on("rp-chat-scroll-down",function(){j.resetScrollDownLastMessageCount(),j.scrollToLastMessage()})},this.bindEvents=function(){R(document).on("rp-chat-maximize rp-chat-minimize",function(e){j.toggleLayer()}),R(document).on("rp-chat-restore",function(e){e=e.originalEvent.detail,R(e.target).closest(".chat-controls").length||j.readCookie("minimized")&&j.toggleLayer()}),R(document).on("rp-chat-close",function(){"chat"!==j.readCookie("window")||f?j.closeChat():j.showContent("close")}),R(document).on("rp-exit-chat",function(){j.closeChat()}),R(document).on("rp-info-close rp-back-to-chat",function(){j.showContent(j.readCookie("window"))}),R(document).on("rp-info-help",function(){j.showContent("help")}),R(document).on("rp-info-datasecurity",function(){"object"==typeof j.readCookie("saveTranscript")||1==j.readCookie("saveTranscript")?R("section#datasecurity input#save-transcript-switcher").prop("checked","checked"):R("section#datasecurity input#save-transcript-switcher").prop("checked",!1),j.showContent("datasecurity")}),R(document).on("rp-info-datasecurity-link",function(){J(document,"rp-info-datasecurity"),void 0!==rp.chat.TrackModule&&void 0!==rp.chat.TrackModule.customerClickLink&&rp.chat.TrackModule.customerClickLink("textlink")}),R(document).on("rp-info-liability",function(){j.showContent("liability")}),R(document).on("rp-copyright",function(){}),R(document).on("rp-file-upload",function(){}),R(document).on("rp-prechat-submit",function(){rp.chat.Core.setRpFp()}),R(document).on("rp-prechat-submit",j.startRouting),R(document).on("rp-email-submit",function(e){var t=!1;if(R('form#form-email [data-chat-validation!=""][data-chat-validation]').each(function(){var e=R(this),o=new RegExp(e.data("chat-validation")),n=e.closest(".form-group"),i=o.test(e.val());if(this.setAttribute("aria-invalid",!i),!i)return n.addClass("has-error"),void(t=!0);n.removeClass("has-error")}),!t){var o=R.extend({session_rp:O,is_mobile:!!U.isMobile},j.objectifyForm(R("form#form-email").serializeArray()));R.post(N+"/layer-v2/sendEmail/"+L,o).done(function(){j.closeChat()}).fail(function(){j.closeChat()})}}),R(document).on("rp-routing-cancel",function(){var e=j.readCookie("chat-id");R.get(N+"/layer-v2/cancel-chat/"+L+"/"+e+"/"+y).done(function(){j.killRequestStateWorker(),j.cancelChatRouting()})}),R(document).on("rp-chat-typing",function(e){var t=(e=e.originalEvent.detail).shiftKey,o=e.which?e.which:e.keyCode;t&&!U.isMobile||13!=o||(e.preventDefault(),R("#form-chat").trigger("submit"),p.emit("preview","")),p.emit("typing"),p.emit("preview",j.messageParser(R("#form-chat").find("#message").val()))}),R(document).on("rp-chat-send",function(e){var t=R("#form-chat"),o={token:y,name:g,timestamp:Math.floor(new Date/1e3),text:j.messageParser(t.find("#message").val()),dept_id:L};if(t.trigger("reset"),t.find("#message").trigger("focus"),o.text){j.destroyQuickReplies(),s.find(".js-bot-footnote").addClass("hide"),s.find("#inputarea").removeClass("botShowInput"),j.updateCookie("botShowInput",null),w&&"object"==typeof k&&(o.quick_reply_type=k.type,o.quick_reply_payload=k.payload,k=void 0),p.emit("customer-message",o),p.emit("preview","");var n=j.readCookie("chat-id");o.isBot=w,R.post(N+"/layer-v2/send-message/"+n,o).done(function(e){void 0===e["session-ended"]?(w&&j.handleBotResponse(e),j.scrollToLastMessage()):R("#form-chat").find("#message").prop("disabled",!0)})}}),R(document).on("rp-pdf-export",function(){window.open(N+"/operation/dialogprotocolpdf.php?session_rp="+O+"&chat_session="+j.readCookie("chat-id")+"&token="+encodeURIComponent(y)+"&deptid="+L+"&sid="+j.readCookie("chat-id")+"&orderid="+v+"&action=view")}),R(document).on("rp-postchat-submit",function(e){var t=R("#form-postchat");if(!z){var o=j.readCookie("chat-id"),n=R.extend({chat_id:o,admin_id:_.id},j.objectifyForm(t.serializeArray()));z=!0,R.post(N+"/layer-v2/save-rating/"+L,n).done(function(){j.closeChat()})}}),R(document).on("rp-unread-messages",function(e){var t=e.originalEvent.detail,o=s.find(".chat-header .chat-title");if(o.length){if(!t||!t.count)return void o.removeAttr("data-unread-count");o.attr("data-unread-count",t.count)}}),R(document).on("rp-unread-messages-scroll-down",function(e){var t=j.readCookie("unread");if(R(".scroll-down-button").is(":visible")){if(!t||0==t)return void R(".scroll-down-button").removeClass("new_message_count");R(".scroll-down-button").attr("data-unread-count",t),R(".scroll-down-button").addClass("new_message_count")}}),R("body").on("click",".js-end-chat",function(){j.closeChat()}),R(document).on("rp-quick-reply",function(e){var t=R(e.originalEvent.detail.currentTarget),o=t.text();k={type:t.attr("data-type"),payload:t.attr("data-payload")},R("#form-chat").find("#message").val(o),R("#form-chat").trigger("submit")}),R("body").on("click",".js-accept-datasecurity",function(e){R(e.target).closest("div").find(".btn").prop("disabled",!0);var t={chat_id:j.readCookie("chat-id"),datasecurity:1,admin_id:_.id,request_id:v};R.post(N+"/layer-v2/save-datasecurity/"+L,t).done(function(){}),R("#form-chat").find("#message").val(R(e.target).text()),k={type:"payload_replaces_response",payload:"data_privacy_accepted"},J(document,"rp-chat-send"),void 0!==rp.chat.TrackModule&&void 0!==rp.chat.TrackModule.customerAcceptPrivacy&&rp.chat.TrackModule.customerAcceptPrivacy(),R(e.target).closest("div").find(".btn").fadeOut("fast"),j.updateCookie("datasecurity","accept"),j.updateCookie("botDataPrivacy",null)}),R("body").on("click",".js-deny-datasecurity",function(e){R(e.target).closest("div").find(".btn").prop("disabled",!0);var t={chat_id:j.readCookie("chat-id"),datasecurity:0,admin_id:_.id,request_id:v};R.post(N+"/layer-v2/save-datasecurity/"+L,t).done(function(){}),R("#form-chat").find("#message").val(R(e.target).text()),k={type:"payload_replaces_response",payload:"data_privacy_rejected"},J(document,"rp-chat-send"),R(e.target).closest("div").find(".btn").fadeOut("fast"),j.updateCookie("datasecurity","deny"),j.updateCookie("botDataPrivacy",null)}),R(document).on("rp-bot-show-input-once",function(e){s.find("#inputarea").addClass("botShowInput"),j.updateCookie("botShowInput",!0)}),R(document).on("rp-bot-show-footnote-once",function(e){s.find(".js-bot-footnote").text(e.detail).removeClass("hide")}),R(document).on("rp-bot-show-data-privacy",function(e){let t=R("section#templates #template-show-data-privacy > *").clone();void 0!==e.detail.question&&""!==e.detail.question&&t.find(".question").html(e.detail.question),void 0!==e.detail.accept&&void 0!==e.detail.reject&&(t.find(".accept").text(e.detail.accept),t.find(".reject").text(e.detail.reject)),t.appendTo("#chat-conversation")}),R("#chat-conversation").on("scroll",function(e){var t=e.target.scrollHeight-e.target.clientHeight-e.target.scrollTop;j.showScrollDownButton(t>30)}),R(document).on("rp-chat-scroll-down",function(){j.scrollToLastMessage()}),R(document).on("rp-layer-opened",function(e){R("span#optiRealPersonContent").addClass("rp-hide")}),R(document).on("rp-layer-closed",function(e){R("span#optiRealPersonContent").removeClass("rp-hide"),rp.chat.Cobrowsing2&&rp.chat.Cobrowsing2.close(),p.emit("customer-close-chat"),z=!1}),R(document).on("rp-layer-created",function(e){1!=j.readCookie("closed")&&R("span#optiRealPersonContent").addClass("rp-hide")}),R(document).on("rp-start-chat",function(e){H=!0}),R("body").on("click","#cobrowsing-user .cobrowsing-start",function(e){e.preventDefault(),R("#cobrowsing-user").html('<p id="cobrowsing-wait">'+window.rp.layer2_lang.COBROWSING_ACCEPT_WAIT+"</p>"),void 0===rp.chat.Cobrowsing2&&null===document.getElementById("realperson-cobrowsingmodul2")?R.ajax({url:B+"/../js/cobrowsing/screensharing-client.js",dataType:"script",id:"realperson-cobrowsingmodul2",data:{session_rp:null},success:function(){rp.chat.Cobrowsing2=new rp.chat.CobrowsingModul2,rp.chat.Cobrowsing2.initialize()}}):void 0===rp.chat.Cobrowsing2&&null!==document.getElementById("realperson-cobrowsingmodul2")?(rp.chat.Cobrowsing2=new rp.chat.CobrowsingModul2,rp.chat.Cobrowsing2.initialize()):rp.chat.Cobrowsing2.initialize();var t={timestamp:Math.floor(new Date/1e3),dept_id:L};p.emit("cobrowsing-customer-accept",t),t={token:y,chat_id:rp.chat.LayerChat.readCookie("chat-id"),type:"client_close",visitor_id:O},R.post(N+"/layer-v2/cobrowsing/"+L,t)}),R("body").on("click","#screenshare-user .screenshare-start",function(e){e.preventDefault();var t=j.readCookie("chat-id");void 0!==$(this).parents("div#screenshare-user:first").data("screen-id")&&(t=$(this).parents("div#screenshare-user:first").data("screen-id")),window.open(B+"/screenshare/#"+parseInt(t).toString(36)+","+L+","+O)}),R("body").on("click","#cobrowsing-close",function(e){e.preventDefault(),rp.chat.Cobrowsing2.close(),j.processSystemNotice({text:window.rp.layer2_lang.COBROWSING_CLOSE_BY_CUSTOMER,timestamp:Math.floor(new Date/1e3)}),R.post(N+"/layer-v2/send-message/"+j.readCookie("chat-id"),{token:y,timestamp:Math.floor(new Date/1e3),text:window.rp.layer2_lang.COBROWSING_CLOSE_BY_CUSTOMER,dept_id:L,type:"alert"})}),R(document).on("click","a[target=_blank]",function(e){U.isMobile&&j.toggleLayer()}),R(document).on("change","section#datasecurity input#switcher-success",function(e){if(this.checked)document.cookie="permission_fp=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/; domain="+rp.chat.Core.getFirstDomainName()+("https:"===window.location.protocol?";secure":""),rp.chat.Core.setConfigEntry("trackRpFp",1);else{var t=new Date;t.setTime(t.getTime()+124416e6),document.cookie="permission_fp=1; expires="+t.toGMTString()+"; path=/; domain="+rp.chat.Core.getFirstDomainName()+("https:"===window.location.protocol?";secure":""),rp.chat.Core.setConfigEntry("trackRpFp",0)}}),R(document).on("change","section#datasecurity input#save-transcript-switcher, section#prechat input#save-transcript",function(e){var t=0;this.checked?(t=1,R("section#datasecurity input#save-transcript-switcher").prop("checked","checked"),R("section#prechat input#save-transcript").prop("checked","checked"),R("section#prechat input#save-transcript").val(1)):(R("section#datasecurity input#save-transcript-switcher").prop("checked",!1),R("section#prechat input#save-transcript").prop("checked",!1),R("section#prechat input#save-transcript").val(0)),j.updateCookie("saveTranscript",t),G(t)}),document.addEventListener("scroll",function(e){if(e.target.classList&&e.target.classList.contains("rp-template-generic")){var t=R(e.target),o=t.scrollLeft()>0?"visible":"hidden";t.find(".rp-template-prev").css({visibility:o,opacity:"hidden"===o?0:1});var n=t.scrollLeft()<t[0].scrollWidth-t.width()?"visible":"hidden";t.find(".rp-template-next").css({visibility:n,opacity:"hidden"===n?0:1})}},!0),R(document).on("click",".rp-template-prev, .rp-template-next",function(e){var t=R(this).closest(".rp-template-generic"),o=this.classList.contains("rp-template-prev")?"prev":"next",n=t.scrollLeft(),i=0;t.find(".rp-template-element").each(function(e,t){if("prev"===o&&t.offsetLeft<n&&(i=e),"next"===o&&t.offsetLeft>n)return i=e+1,!1});var s=t.find(".rp-template-element").first().outerWidth(!0),a=t.outerWidth(!0),r=i*s-(a-s)/2;t.stop().animate({scrollLeft:r})}),R(document).on("rp-template-button",function(e){var t=R(e.detail.currentTarget);t.closest(".message").is(R("#chat-conversation > .message").last())&&(R("#form-chat").find("#message").val(t.attr("data-payload")),R("#form-chat").trigger("submit"))})},this.cancelChatRouting=function(){j.resetForm("form-prechat"),j.updateCookie("datasecurity",void 0),j.stopPing(),j.closeChat()},j.resetForm=function(e){R("form#"+e)[0].reset()},this.messageParser=function(e){return e=R.trim(e.replace(/<.*?>/g,""))},this.bindSocketEvents=function(){p.on("agent-identity",function(e){void 0!==e&&(j.processAgentIdentity(e),w&&s.removeClass("isBot")),j.ping({chat_id:e.chat_id,token:y}),j.showContent("chat",!0),j.killRequestStateWorker(),h&&(clearTimeout(h),h=void 0),e.greeting_message&&j.processSystemInfo({text:e.greeting_message},function(t){e.transfer&&t.addClass("transfer").find(".answer-selection").remove()}),j.scrollToLastMessage()}),p.on("customer-close-chat",function(){s.fadeOut(200,function(){j.resetForm("form-prechat"),j.updateCookie("datasecurity",void 0),R("#chat-conversation").html(""),p.emit("leave"),clearTimeout(h),h=void 0,j.showContent("prechat",!0,null,!0),J(document,"rp-layer-closed")})}),p.on("customer-message",function(e){j.processOutgoingMessage(e,function(){j.scrollToLastMessage()})});var e=0;p.on("operator-message",function(t){var o=0;if(t.delay&&(o=t.delay,e++,j.showTypingMessage(!0)),setTimeout(function(){j.processIncomingMessage(t,function(){j.showTypingMessage(!1),o&&e>1&&(setTimeout(function(){j.showTypingMessage(!0)},300),e--)})},o),!s.find(".chat-body").is(":visible")){var n=j.readCookie("unread")+1;J(document,"rp-unread-messages",{count:n,last:t.text,picture:_.picture?_.picture:void 0}),j.updateCookie("unread",n)}}),p.on("agent-disconnected",function(){h||f||(h=setTimeout(function(){p.emit("timeout"),rp.chat.Cobrowsing2&&rp.chat.Cobrowsing2.close()},3e4))}),p.on("timeout",function(){j.processSystemNotice({text:window.rp.layer2_lang.CHAT_PARTYLEFTSESSION_TIMEOUT,timestamp:Math.floor(new Date/1e3)}),R("#form-chat").find("#message").prop("disabled",!0),void 0!==j._uploader&&j._uploader.disable(),j.stopPing(),j.scrollToLastMessage()}),p.on("agent-left",function(){var e=j.readCookie("chat-id");R.post(N+"/layer-v2/dump-transcript",{chat_id:e}),j.stopPing(),j.processSystemNotice({text:window.rp.layer2_lang.CHAT_PARTYLEFTSESSION_AGENT,timestamp:Math.floor(new Date/1e3)}),R("#form-chat").find("#message").prop("disabled",!0),void 0!==j._uploader&&j._uploader.disable(),f=!0,h&&(clearTimeout(h),h=void 0),j.scrollToLastMessage(),rp.chat.Cobrowsing2&&rp.chat.Cobrowsing2.close()}),p.on("connect",function(){var e=j.readCookie("chat-id");e&&(p.emit("join",e),b&&(console.log("reload chat content"),b=!1,R.getJSON(N+"/layer-v2/ischatting/"+O,function(t){e==t.chat_id?(R("#chat-conversation").html(""),j.processTranscriptEvents(t.events),j.readCookie("botQuickReplies")&&j.readCookie("botQuickReplies").length&&j.processQuickReplies(j.readCookie("botQuickReplies")),j.scrollToLastMessage(),j.resetScrollDownLastMessageCount(),t.identity&&J(document,"rp-agent-identity",{name:t.identity.name,picture:t.identity.picture?_profileImageUrl+"/"+t.identity.picture:void 0}),void 0!==j.readCookie("datasecurity")&&R(".js-accept-datasecurity").closest("div").addClass("hidden")):console.log("chat_id does not match"),t.is_chatting||(j.stopPing(),R("#form-chat").find("#message").prop("disabled",!0),void 0!==j._uploader&&j._uploader.disable(),f=!0,h&&(clearTimeout(h),h=void 0),j.scrollToLastMessage(),rp.chat.Cobrowsing2&&rp.chat.Cobrowsing2.close(),void 0!==rp.chat.TrackModule&&void 0!==rp.chat.TrackModule.closeChat&&rp.chat.TrackModule.closeChat("operator"))})))}),p.on("joined",function(){p.emit("preview","")}),p.on("typing",function(){m&&clearTimeout(m),j.showTypingMessage(!0),m=setTimeout(function(){m=void 0,j.showTypingMessage(!1)},2e3)}),p.on("transfer-initiated",function(e){j.runRequestStateWorker(),j.updateCookie("isRouting",!0),e&&(j.processSystemNotice({text:e,timestamp:Math.floor(new Date/1e3)}),j.scrollToLastMessage())}),p.on("disconnect",function(){b=!0,console.log("verbindung getrennt")})},this.startRouting=function(e){if(!A)if(void 0!==p){var t=!1;if(R("form#form-prechat [data-chat-validation]").not('[data-chat-validation=""]').each(function(){var e=R(this),o=new RegExp(e.data("chat-validation")),n=e.closest(".form-group");"radio"==e.prop("type")&&(e=R("[name="+e.prop("name")+"]:checked"));var i=o.test(e.val());if(this.setAttribute("aria-invalid",!i),!i)return n.addClass("has-error"),void(t=!0);n.removeClass("has-error")}),!t||!U.prechatEnabled){var o=R.extend({display_width:screen.width,display_height:screen.height,visitor_id:O,is_webrtc:rp.chat.Core.getWebRTCDetected(),rpfp:rp.chat.Core.getFp(),pagename:rp.chat.Core.getPagename(),page_url:rp.chat.Core.getCurrentUrl(),mobile_device:U.isMobile||0,invite_type:E,sid_opti:rp.chat.Core.getSidOpti(),businessrule_id:l||0,adblock_detected:"function"==typeof rp.chat.Core.getAdBlockDetected?rp.chat.Core.getAdBlockDetected():0,timestamp:(new Date).toJSON(),save_transcript:R("form#form-prechat").find("#save-transcript").length?R("form#form-prechat").find("#save-transcript").val():1,video_support:0,social_login:{network:"realperson",id:"",payload:""},campaign_active:U.campaign_active,campaign_data:U.campaign_data},j.objectifyForm(R("form#form-prechat").serializeArray()));void 0!==rpChatConfig.mobileLink&&void 0!==rpChatConfig.mobileLink.active&&rpChatConfig.mobileLink.active&&(o.name=rpChatConfig.mobileLink.customerName,o.profile_id=rpChatConfig.mobileLink.profileId,o.message=rpChatConfig.mobileLink.question,o.save_transcript=1,o.previous_chat_id=rpChatConfig.mobileLink.previousChatId,o.previous_customer_id=rpChatConfig.mobileLink.previousCustomerId,o.previous_visitor_id=rpChatConfig.mobileLink.previousVisitorId);var n=o;A=!0,R.post(N+"/layer-v2/request-chat/"+L,o).done(function(e){if(e.success){if(p.emit("join",e.session_id),j.updateCookie("chat-id",e.session_id),j.updateCookie("dept-id",L),y=e.token,J(document,"rp-chat-running"),(g=n.name)||(g=window.rp.layer2_lang.CUSTOMER),v=e.request_id,e.message&&""!=e.message.text&&j.processOutgoingMessage(e.message),e.is_bot)return w=!0,j.processAgentIdentity(e.identity),j.handleBotResponse(e),j.scrollToLastMessage(),j.ping({chat_id:e.session_id,token:y}),j.showContent("chat",!0),s.addClass("isBot"),void(e.frontend_hide_input&&s.addClass("botHideInput"));j.showContent("routing",!0),j.runRequestStateWorker()}else void 0!==e.chatIsRunning||j.gotoContact()}).fail(function(){j.gotoContact()}),j.bindScrollEvents()}}else setTimeout(function(){j.startRouting()},500)},this.ping=function(e){j.stopPing(),R.post(N+"/layer-v2/ping",e).done(function(t){if(!t.chat_running)return j.processSystemNotice({text:window.rp.layer2_lang.CHAT_PARTYLEFTSESSION_AGENT,timestamp:Math.floor(new Date/1e3)}),R("#form-chat").find("#message").prop("disabled",!0),void(void 0!==j._uploader&&j._uploader.disable());u=setTimeout(function(){j.ping(e)},1e4)}).fail(function(t){u=setTimeout(function(){j.ping(e)},1e4)})},this.stopPing=function(e){void 0!==u&&(clearTimeout(u),u=void 0)},this.gotoContact=function(){j.resetForm("form-email"),j.updateCookie("datasecurity",void 0),R("form#form-email [name=name]").val(R("form#form-prechat [name=name]").val()),R("form#form-email [name=email]").val(R("form#form-prechat [name=email]").val()),R("form#form-email [name=messagetext]").val(R("form#form-prechat [name=message]").val()),j.showContent(U.offlineWindow,!0),j.resetForm("form-prechat"),R("#chat-conversation").html(""),p.emit("leave"),clearTimeout(h),h=void 0,f=void 0,R("#form-chat").find("#message").prop("disabled",!1),void 0!==j._uploader&&j._uploader.enable(),j.updateCookie("unread",0),j.updateCookie("chat-id",0),j.updateCookie("saveTranscript",1),y=void 0,j.updateCookie("dept-id",0),L=rp.chat.Core.getDeptId(),j.stopPing(),J(document,"rp-chat-ended");var e="MissingView";switch(U.offlineWindow){case"hotline":e="status_button_hotline_max_capacity";break;case"contact":e="status_button_contact_max_capacity"}j.saveContentViews(e)},this.runRequestStateWorker=function(e){v&&(x=setTimeout(function(){R.get(N+"/layer-v2/request-state/"+v).done(function(t){if(j.readCookie("chat-id")){if(!t.response)return j.updateCookie("isRouting",!1),"function"==typeof e?void e():void j.gotoContact();var o=t.response;if(o.request_id==v)return"unknown"==o.state||"no_agent_available"==o.state?(j.updateCookie("isRouting",!1),R.get(N+"/layer-v2/unset-session/"+O),"function"==typeof e?void e():void j.gotoContact()):"routing"==o.state||"transfering"==o.state?"function"==typeof e&&o.profile_id==_.id?void e():void j.runRequestStateWorker(e):void 0}}).fail(function(){j.updateCookie("isRouting",!1),"function"!=typeof e?j.gotoContact():e()})},1e3))},this.killRequestStateWorker=function(e){j.updateCookie("isRouting",!1),void 0!==x&&(clearTimeout(x),x=void 0)},this.objectifyForm=function(e){for(var t={},o=0;o<e.length;o++)t[e[o].name]=e[o].value;return t},this.registerDragAndDrop=function(){var e,t,o=null,n=s.find(".drag-handle"),i=j.readCookie("left"),a=j.readCookie("top");R(window).on("resize",function(e){S=rp.chat.Core.getBrowserHeight(),M=rp.chat.Core.getBrowserWidth(),j.setChatPosition(s,i,a)}),R(document).on("mousedown","#realpersonChatWrapper > .drag-handle",function(i){R(i.target).closest(".chat-controls").length||1!==i.which||s.hasClass("minimized")||(e=i.pageX-n.offset().left,t=i.pageY-n.offset().top,R(document).attr("unselectable","on").css("user-select","none").on("selectstart",!1),o=s)}).on("mouseup",function(e){o&&(o=null,R(document).removeAttr("unselectable").css("user-select","").off("selectstart"))}).on("mousemove",function(n){o&&(i=n.pageX-window.pageXOffset-e,a=n.pageY-window.pageYOffset-t,j.setChatPosition(s,i,a))})},this.setChatPosition=function(e,t,o){if(r=s.outerHeight(!0),a=s.outerWidth(!0),o<=20&&(o=20),o>=S-r){o=S-r-0,s.addClass("docked-bottom")}else s.removeClass("docked-bottom");t<=20&&(t=20),t+a+20>=M&&(t=M-a-20)<20&&(t=20),e.css({position:"fixed",top:o,left:t}),j.updateCookie("left",t),j.updateCookie("top",o),!0},this.readCookie=function(e){var t=Cookies.getJSON("rp-layerchat")||q;return void 0===e?t:t[e]},this.updateCookie=function(e,t){(c=Cookies.getJSON("rp-layerchat")||q)[e]=t;var o={path:"/",domain:rp.chat.Core.getFirstDomainName(),secure:"https:"===window.location.protocol,sameSite:"none"};Cookies.set("rp-layerchat",c,o)},this.showContent=function(e,t,o,n){var i=s.find("section#"+e),a=s.find("section"),r=s.find(".chat-body");("routing"==e||"prechat"==e&&n)&&"prechat"==d&&j.saveContentViews("prechat-close"),d=e,A="routing"==e,n&&r.removeAttr("aria-live"),i.length&&(a.not(i).hide(),i.fadeIn(400,function(){i.find(".default-focus").focus()}),t&&j.updateCookie("window",e)),"postchat"===e&&rp.chat.Cobrowsing2&&rp.chat.Cobrowsing2.close(),j.loadDepencies(e),"function"==typeof o&&o()},this.saveContentViews=function(e){var t={type:e,visitor_id:O,is_mobile:!!U.isMobile,origin:E,campaign:U.campaign_data};R.post(N+"/layer-v2/content-views/"+L,t).done(function(e){}).fail(function(){})},this.resetChat=function(){},this.closeChat=function(){var e=this;e.readCookie("chat-id");R.getJSON(N+"/layer-v2/ischatting/"+O,function(t){1==t.is_chatting||f?R.get(N+"/layer-v2/exit-layer/"+O,function(){e.resetForm("form-prechat"),e.resetForm("form-postchat"),e.updateCookie("datasecurity",void 0),R.fn.barrating&&R(".stars",s).barrating("clear"),R("#chat-conversation").html(""),R("#form-chat #message").prop("disabled",!1),R("#form-chat").removeClass("hide"),p.emit("leave"),clearTimeout(h),h=void 0,f=void 0,R("#form-chat").find("#message").prop("disabled",!1),s.find("#inputarea").removeClass("botShowInput"),e.updateCookie("botShowInput",null),s.removeClass("isBot"),s.removeClass("botHideInput"),void 0!==e._uploader&&e._uploader.enable(),e.updateCookie("unread",0),e.stopPing(),J(document,"rp-chat-ended"),_&&!A?e.showContent("postchat",!0):e.hideChat(function(){e.showContent("prechat",!0,null,!0),e.updateCookie("chat-id",0),e.updateCookie("saveTranscript",1),y=void 0,e.updateCookie("dept-id",0),L=rp.chat.Core.getDeptId(),e.updateCookie("closed",!0),J(document,"rp-layer-closed")})}):(s.fadeOut(200,function(){e.resetForm("form-prechat"),e.resetForm("form-postchat"),R.fn.barrating&&R(".stars",s).barrating("clear"),R("#chat-conversation").html(""),p.emit("leave"),clearTimeout(h),h=void 0,e.showContent("prechat",!0,null,!0),J(document,"rp-layer-closed")}),R.get(N+"/layer-v2/unset-session/"+O).done(function(){e.updateCookie("closed",!0),e.updateCookie("chat-id",0),e.updateCookie("saveTranscript",1),y=void 0,e.updateCookie("dept-id",0),L=rp.chat.Core.getDeptId(),e.updateCookie("unread",0),e.stopPing()}))}),C=!1},this.toggleLayer=function(e){if(j.readCookie("minimized"))j.maximizeLayer(),j.scrollToLastMessage();else{j.minimizeLayer(),J(document,"rp-unread-messages");var t=j.readCookie("unread");t>0&&J(document,"rp-unread-messages",{count:t})}"function"==typeof e&&e(j.readCookie("minimized"))},this.maximizeLayer=function(){if(null==s)return!1;s.removeClass("minimized"),j.updateCookie("minimized",!1),j.markAllAsRead()},this.markAllAsRead=function(){j.updateCookie("unread",0),J(document,"rp-unread-messages",{count:j.readCookie("unread")})},this.minimizeLayer=function(e){if(null==s)return!1;s.addClass("minimized"),j.updateCookie("minimized",!0)},this.removeCloseButton=function(){I.addClass("hide")},this.showCloseButton=function(){I.removeClass("hide")},this.getChatLayerIsActive=function(){return j.readCookie("closed")?0:1},this.processTranscriptEvents=function(e){R.each(e,function(e,t){switch(t.type){case"incoming":if(""==t.text)return;j.processIncomingMessage({name:t.name,timestamp:t.timestamp,text:t.text});break;case"outgoing":case"entry-question":if(""==t.text)return;j.processOutgoingMessage({name:t.name,timestamp:t.timestamp,text:t.text});break;case"notice":case"system-info":if(""==t.text)return;j.processSystemNotice({timestamp:t.timestamp,text:t.text});break;case"connected":if(""==t.text)return;j.processSystemInfo({text:t.text});break;case"exit":R("#form-chat").find("#message").prop("disabled",!0),void 0!==j._uploader&&j._uploader.disable(),f=!0}})},this.processAgentIdentity=function(e){w||(s.removeClass("botHideInput"),R("#form-chat").find("#message").prop("disabled",!1)),e.picture?(s.find(".agent-picture").prop("src",e.picture),s.find("#chat").find(".header").addClass("header-w-pic"),s.find(".picture").removeClass("hidden")):(s.find("#chat").find(".header").removeClass("header-w-pic"),s.find(".picture").addClass("hidden")),s.find(".agent-name").text(e.name),_=e,J(document,"rp-agent-identity",{name:e.name,picture:e.picture?e.picture:void 0,transfer:e.transfer})},this.processOutgoingMessage=function(e,t){var o=void 0!==e.type&&"info"==e.type?R("section#templates #template-message-incoming-info > *").clone():R("section#templates #template-message-outgoing > *").clone();o.find(".customer").html(e.name);var n=o.find(".time").data("date-format");o.find(".time").html(n?i(new Date(1e3*parseInt(e.timestamp)),n):e.timestamp),o.find(".text").html(e.text).find("a").prop("target","_blank"),R("#chat-conversation .typing").remove(),o.appendTo("#chat-conversation"),"function"==typeof t&&t(o)},this.processIncomingMessage=function(e,t){var o=R("section#templates #template-message-incoming > *").clone();o.find(".operator").html(e.name),""==e.name&&o.find(".operator").addClass("hidden");var n=o.find(".time").data("date-format");if(o.find(".time").html(n?i(new Date(1e3*parseInt(e.timestamp)),n):e.timestamp),o.find(".text").html(e.text).find("a").prop("target","_blank"),T&&T.length>0&&(T.remove(),T=void 0),o.appendTo("#chat-conversation"),R(".scroll-down-button").is(":visible")){R(".scroll-down-button i").removeClass("rp-icon-ios-more"),R(".scroll-down-button i").addClass("rp-icon-chevron-down");var s=j.readCookie("unread")+1;j.updateCookie("unread",s),J(document,"rp-unread-messages-scroll-down")}else j.scrollToLastMessage();"function"==typeof t&&t(o)},this.processIncomingBotMessage=function(e,t){var o=R("section#templates #template-message-incoming > *").clone();o.find(".operator").html(e.name);var n=o.find(".time").data("date-format");o.find(".time").html(n?i(new Date(parseInt(e.timestamp)),n):e.timestamp),o.find(".text").html(e.text),R("#chat-conversation .typing").remove(),o.appendTo("#chat-conversation"),"function"==typeof t&&t(o)},this.processQuickReplies=function(e,t){var o=R("section#templates #template-quick-replies > *").clone();R.each(e,function(e,t){var n=R('<button class="btn btn-primary" />');n.attr("data-chat-event","rp-quick-reply"),t.type&&n.attr("data-type",t.type),t.payload&&n.attr("data-payload",t.payload),n.text(t.title),n.appendTo(o)}),o.appendTo("#chat-conversation"),"function"==typeof t&&t(o)},this.destroyQuickReplies=function(){R("#chat-conversation .quick-replies").remove(),j.updateCookie("botQuickReplies",[])},this.processAction=function(e,t){switch(e.name){case"finished":j.stopPing(),R("#form-chat #message").prop("disabled",!0),R("#chat-conversation button").prop("disabled",!0),R("#form-chat").addClass("hide"),R.get(N+"/layer-v2/exit-layer/"+O,function(){});break;case"handover":j.botTriggerHandover("chat",e.payload,function(e){e.status&&e.status.success?(p.emit("leave"),L=parseInt(e.status.deptId),j.updateCookie("dept-id",L),v=e.status.requestId,y=e.status.token,j.updateCookie("chat-id",e.status.chatId),p.emit("join",e.status.chatId),j.stopPing(),j.ping({chat_id:e.status.chatId,token:y}),R.post(B+"/layer-v2/postchat/"+e.status.deptId,{visitor_id:O}).done(function(e){R("#postchat").html(e),_barRatingLoaded&&s.find(".stars").barrating({theme:"rp-stars-o"})}),w=!1,j.updateCookie("isRouting",!0),j.runRequestStateWorker(function(){w=!0,j.botSendInternalMessage("handover_agent_not_available",function(e){j.handleBotResponse(e),j.scrollToLastMessage(),s.addClass("isBot")})})):j.botSendInternalMessage("handover_agent_not_available",function(e){j.handleBotResponse(e),j.scrollToLastMessage()})});break;case"availability":j.botCheckAvailability(e.payload,function(e){j.botSendInternalMessage(e.available?"agent_available":"agent_not_available",function(e){j.handleBotResponse(e),j.scrollToLastMessage()})});break;case"terminate":J(document,"rp-exit-chat");break;case"show-input":J(document,"rp-bot-show-input-once");break;case"show-footnote":J(document,"rp-bot-show-footnote-once",e.payload);break;case"show-data-privacy":J(document,"rp-bot-show-data-privacy",e.payload),j.updateCookie("botDataPrivacy",e.payload)}"function"==typeof t&&t()},this.processSystemNotice=function(e,t){var o=R("section#templates #template-message-system-notice > *").clone();o.find(".text").html(e.text);var n=o.find(".time").data("date-format");o.find(".time").html(n?i(new Date(1e3*parseInt(e.timestamp)),n):e.timestamp),o.appendTo("#chat-conversation"),"function"==typeof t&&t(o)},this.processSystemInfo=function(e,t){var o=R("section#templates #template-message-system-info > *").clone();o.find(".text").html(e.text),o.appendTo("#chat-conversation"),"function"==typeof t&&t(o)},this.showTypingMessage=function(e){e?R(".scroll-down-button").is(":visible")?(R(".scroll-down-button i").removeClass("rp-icon-chevron-down"),R(".scroll-down-button i").addClass("rp-icon-ios-more")):R("#chat-conversation .typing")&&R("#chat-conversation .typing").length>0?(R("#chat-conversation .typing").find(".text").html(window.rp.layer2_lang.IS_TYPING),R("#chat-conversation .typing").find(".agent-name").html(_.name),R("#chat-conversation .typing").css("visibility","visible")):((T=R("section#templates #template-typing > *").clone()).find(".text").html(window.rp.layer2_lang.IS_TYPING),T.appendTo("#chat-conversation"),j.scrollToLastMessage()):(R(".scroll-down-button").is(":visible")&&(R(".scroll-down-button i").removeClass("rp-icon-ios-more"),R(".scroll-down-button i").addClass("rp-icon-chevron-down")),T&&T.length>0&&T.css("visibility","hidden"))},this.botSendInternalMessage=function(e,t){t=t||function(e){};var o=j.readCookie("chat-id");j.destroyQuickReplies(),R.post(N+"/layer-v2/send-message/"+o,{token:y,name:g,timestamp:Math.floor(new Date/1e3),text:e,dept_id:L,isBot:!0,no_save:!0}).done(t)},this.botTriggerHandover=function(e,t,o){o=o||function(e){},(t=t||{}).token=y;var n=j.readCookie("chat-id");R.post(N+"/layer-v2/bot-handover/"+n+"/"+e,t).done(o)},this.botCheckAvailability=function(e,t){t=t||function(e){},(e=e||{}).token=y;var o=j.readCookie("chat-id");R.post(N+"/layer-v2/bot-check-availability/"+o,e).done(t)},this.handleBotResponse=function(e){if(e.response)if(e.response.quickReplies&&e.response.quickReplies.length&&j.updateCookie("botQuickReplies",e.response.quickReplies),e.response.text&&e.response.text.length){var t=!Q.length;R.each(e.response.text,function(t,o){Q.push({id:e.response.id,text:o,quickReplies:t+1===e.response.text.length&&e.response.quickReplies&&e.response.quickReplies.length?e.response.quickReplies:void 0,actions:t+1===e.response.text.length&&e.response.actions?e.response.actions:void 0})}),t&&(j.showTypingMessage(!0),setTimeout(j.processBotResponseQueue,1e3*Math.random()+500))}else e.response.actions&&e.response.actions.length&&R.each(e.response.actions,function(e,t){j.processAction(t)})};var W,X,Q=[];this.processBotResponseQueue=function(){if(Q.length){var e=Q.shift();if(j.processIncomingBotMessage({id:e.id,name:_.name,timestamp:Math.floor(new Date/1e3),text:e.text},function(){Q.length?(j.showTypingMessage(!1),j.showTypingMessage(!0)):(j.showTypingMessage(!1),e.quickReplies&&e.quickReplies.length&&j.processQuickReplies(e.quickReplies),e.actions&&e.actions.length&&R.each(e.actions,function(e,t){j.processAction(t)}),j.scrollToLastMessage())}),!s.find(".chat-body").is(":visible")){var t=j.readCookie("unread")+1;J(document,"rp-unread-messages",{count:t,last:e.text,picture:_.picture?_.picture:void 0}),j.updateCookie("unread",t)}R("#chat-conversation").trigger("scroll"),setTimeout(j.processBotResponseQueue,1e3*Math.random()+500)}},this.showScrollDownButton=function(e){e&&!W&&(W=R("section#templates #template-scroll-down > *").clone()).appendTo("#chat-conversation"),!e&&W&&(W.remove(),W=void 0,j.resetScrollDownLastMessageCount())},this.scrollToLastMessage=function(){R("#chat-conversation").stop().animate({scrollTop:999999},500)},this.resetScrollDownLastMessageCount=function(){j.updateCookie("unread",0),R(".scroll-down-button").attr("data-unread-count",0),R(".scroll-down-button").removeClass("new_message_count")},this.setLayer=function(e,t,o,n){E=e,l=o;var i=j.readCookie("left"),a=j.readCookie("top");j.setChatPosition(s,i,a);var r=R("#send-photo-button"),c=R("#upload-progress-wrap");r.length&&void 0===j._uploader&&(j._uploader=new ss.SimpleUpload({button:r,url:N+"/mobile/file_upload.php?sid="+j.readCookie("chat-id"),sessionProgressUrl:N+"/mobile/sessionProgress.php",name:"imgfile",multiple:!1,multipart:!1,maxUploads:2,maxSize:12e3,queue:!1,hoverClass:"ui-state-hover",allowedExtensions:["jpg","jpeg","png","gif","mov","mp4","ogg","pdf"],debug:!0,responseType:"json",onSubmit:function(e,t){var o=R("<div></div>",{class:"prog"}),n=R("<div></div>",{class:"progress"}),i=R("<div></div>",{class:"progress-bar progress-bar-success"}),s=R("<div></div>",{class:"size"});n.append(i),o.append(s),o.append(n),c.append(o),this.setProgressBar(i),this.setProgressContainer(o)},onSizeError:function(){j.processSystemNotice({text:window.rp.layer2_lang.FILE_TOO_LARGE,timestamp:Math.floor(new Date/1e3)})},onExtError:function(){j.processSystemNotice({text:window.rp.layer2_lang.FILE_TYPE_NOT_ALLOWED,timestamp:Math.floor(new Date/1e3)})},onComplete:function(e,t){t||j.processSystemNotice({text:window.rp.layer2_lang.FILE_UPLOAD_FAILED,timestamp:Math.floor(new Date/1e3)}),!0===t.success?(j.processSystemNotice({text:window.rp.layer2_lang.FILE_CHECKING_FILE,timestamp:Math.floor(new Date/1e3)}),R.ajax({type:"POST",url:N+"/mobile/file_upload.php",data:{action:"vc",file:t.file},success:function(e){if(!0===e.success){var o;R(".file-upload-message").remove(),j.processSystemNotice({text:window.rp.layer2_lang.FILE_SUCCESS,timestamp:Math.floor(new Date/1e3)}),t.type.match("image/(.*)")&&(o='<a href="'+encodeURI(e.url)+'" data-target="#photoUploadImageModal"><img src="'+encodeURI(e.url)+'" class="img-responsive img-thumbnail"></a>'),t.type.match("video/(.*)")&&(o='<video src="'+encodeURI(e.url)+'" class="img-responsive img-thumbnail" controls autobuffer></video>'),t.type.match("image/(.*)")||t.type.match("video/(.*)")||(o='<a href="'+encodeURI(e.url)+'" target="_blank">'+t.file+"</a>");e={token:y,name:g,timestamp:Math.floor(new Date/1e3),raw:!0,text:o,dept_id:L};p.emit("customer-message",e);var n=j.readCookie("chat-id");R.post(N+"/layer-v2/send-message/"+n,e).done(function(){})}else j.processSystemNotice({text:window.rp.layer2_lang.FILE_UPLOAD_FAILED,timestamp:Math.floor(new Date/1e3)})},dataType:"json"})):t.msg?j.processSystemNotice({text:t.msg,timestamp:Math.floor(new Date/1e3)}):j.processSystemNotice({text:window.rp.layer2_lang.FILE_UPLOAD_FAILED,timestamp:Math.floor(new Date/1e3)})}})),R.getJSON(N+"/layer-v2/ischatting/"+O,function(e){void 0===window.io?rp.chat.loadScript(F,function(){j.initSocket()}):j.initSocket();var t=j.readCookie("window");C||1!=e.is_chatting&&!j.readCookie("chat-id")||"postchat"==t?0!=j.readCookie("closed")||"prechat"!=t&&"contact"!=t&&"hotline"!=t?"prechat"==t||"contact"==t||"hotline"==t||"chat"==t&&!e.is_chatting||"routing"==t&&!e.is_chatting?R.getJSON(B+"/layer-v2/availability/"+L).done(function(e){if(void 0!==rpChatConfig.mobileLink&&void 0!==rpChatConfig.mobileLink.active&&rpChatConfig.mobileLink.active&&(U.prechatEnabled=!1,e.available=!0),0==e.available)return j.resetForm("form-email"),void j.showChat(U.offlineWindow,function(){"contact"!=t&&"hotline"!=t&&j.saveContentViews("contact"==U.offlineWindow?"status_button_contact_max_capacity":"status_button_hotline_max_capacity"),J(document,"rp-layer-opened"),C=!0});j.showChat(U.prechatEnabled?"prechat":"routing",function(){U.prechatEnabled?U.prechatEnabled&&H&&"prechat"==t&&j.saveContentViews("status_button_prechat"):(j.saveContentViews("disabled_prechat"),A=!1,j.startRouting(),j.runRequestStateWorker()),J(document,"rp-layer-opened"),C=!0})}).fail(function(e){}):("postchat"==t&&(j.readCookie("chat-id")?_=e.identity:t="prechat"),j.showChat(t,function(){"prechat"!=t||U.prechatEnabled||j.startRouting(),J(document,"rp-layer-opened")})):(j.showChat(t),J(document,"rp-layer-opened"),C=!0):(j.updateCookie("chat-id",e.chat_id),j.updateCookie("closed",!1),y=e.token,J(document,"rp-chat-running"),v=e.request_id,void 0!==e.identity&&(t="chat",j.processAgentIdentity(e.identity)),(j.readCookie("isRouting")||void 0===e.identity)&&j.runRequestStateWorker(),j.showChat(t,function(){if(p&&p.emit("join",e.chat_id),j.ping({chat_id:e.chat_id,token:y}),g=e.name,v=e.request_id,(w=!!e.is_bot)&&(s.addClass("isBot"),e.frontend_hide_input&&(s.addClass("botHideInput"),j.readCookie("botShowInput")&&s.find("#inputarea").addClass("botShowInput"))),j.processTranscriptEvents(e.events),j.readCookie("botQuickReplies")&&j.readCookie("botQuickReplies").length&&j.processQuickReplies(j.readCookie("botQuickReplies")),j.readCookie("botDataPrivacy")&&(J(document,"rp-bot-show-data-privacy",j.readCookie("botDataPrivacy")),j.updateCookie("botDataPrivacy",null)),j.scrollToLastMessage(),j.bindScrollEvents(),j.resetScrollDownLastMessageCount(),!s.find(".chat-body").is(":visible")){var t=j.readCookie("unread");J(document,"rp-unread-messages",{count:t})}void 0!==j.readCookie("datasecurity")&&R(".js-accept-datasecurity").closest("div").addClass("hidden"),J(document,"rp-layer-opened"),C=!0}))})},this.showChat=function(e,t){void 0===e&&(e="prechat"),j.showContent(e,!0),s.fadeIn(400,function(){s.removeClass("closed"),j.updateCookie("closed",!1)}),"function"==typeof t&&t()},this.hideChat=function(e){s.fadeOut(200,function(){s.addClass("closed"),j.updateCookie("closed",!0)}),"function"==typeof e&&e()},this.initSocket=function(){if(void 0===p){var e=/^https?:\/\/[^\/]+/.exec(F)[0];p=window.io(e+"/chat",{path:"/socket/socket.io",transports:["websocket","polling"]}),j.bindSocketEvents()}},this.createLayer=function(e){if(void 0===s)try{if(window.rpChatConfig.containerSelector?s=R(rpChatConfig.containerSelector):(s=R("<div>",{id:"realpersonChatWrapper"}),U.isMobile&&s.addClass("mobile")),j.readCookie("minimized")&&s.addClass("minimized"),j.readCookie("dept-id")&&(L=j.readCookie("dept-id")),s.addClass("closed"),s.css("display","none"),!R("#realpersonChatWrapper").length){var t=!1,o=R("<link>",{type:"text/css",rel:"stylesheet",href:B+"/layouts/"+U.theme+"/css/layer2.css"});o.on("load",function(){o.off("load"),t=!0}),P.append(o),window.rpChatConfig.containerSelector||D.append(s),j.readCookie("closed")||s.removeClass("closed"),R(document).on("click",'[data-chat-event]:not([data-chat-event-type]),[data-chat-event][data-chat-event-type="click"]',function(e){e.preventDefault();var t=R(this).data("chat-event");J(document,t,e)}),R(document).on("keyup",'[data-chat-event][data-chat-event-type="keyup"]',function(e){var t=R(this).data("chat-event");J(document,t,e)}),R(document).on("keydown",'[data-chat-event][data-chat-event-type="keydown"]',function(e){var t=R(this).data("chat-event");J(document,t,e)}),R(document).on("keypress",'[data-chat-event][data-chat-event-type="keypress"]',function(e){var t=R(this).data("chat-event");J(document,t,e)}),R(document).on("submit",'[data-chat-event][data-chat-event-type="submit"]',function(e){e.preventDefault();var t=R(this).data("chat-event");J(document,t,e)});var n=function(o){t?(0==j.readCookie("closed")?j.initLayerContent(function(){j.setLayer(0),"function"==typeof e&&e()}):e(),J(document,"rp-layer-created")):setTimeout(n,o)};n(50)}}catch(e){}},this.initLayerContent=function(e){void 0!==s&&(X!=L?(X=L,R.post(B+"/layer-v2/init/"+L,{visitor_id:O}).done(function(t){s.html(t),r=s.outerHeight(!0),a=s.outerWidth(!0);var o=j.readCookie("left"),n=j.readCookie("top");s.find(".drag-handle").length&&!window.rpChatConfig.disableDragging?(j.registerDragAndDrop(),j.setChatPosition(s,o,n),s.removeClass("no-drag-and-drop")):s.addClass("no-drag-and-drop"),"function"==typeof e&&e()})):"function"==typeof e&&e())};var J=function(e,t,o){var n=document.createEvent("CustomEvent");n.initCustomEvent(t,!0,!0,o),e.dispatchEvent(n)},G=function(e){if(j.readCookie("chat-id")>0){var t={chat_id:j.readCookie("chat-id"),datasecurity:e,admin_id:_.id,request_id:v};R.post(N+"/layer-v2/save-datasecurity/"+L,t)}}};
//# sourceMappingURL=loadlayerchatmodul-v2.js.map
